<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
<title>Ramadan Tracker 1447</title>
<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;0,700;1,400&family=Noto+Naskh+Arabic:wght@400;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
  --black:#000;--black2:#0a0a0a;--black3:#111;--black4:#181818;
  --green:#2d6a4f;--green-mid:#3d8b5e;--green-light:#52b87a;--green-bright:#6ed898;
  --green-pale:rgba(45,106,79,0.18);--gold:#c9963a;--gold-light:#e8b94a;
  --surface:rgba(255,255,255,0.04);--border:rgba(255,255,255,0.08);
  --text:#f0f4f1;--text-dim:rgba(240,244,241,0.5);--text-faint:rgba(240,244,241,0.22);
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{background:#000;color:var(--text);font-family:'Lora',Georgia,serif;min-height:100vh;-webkit-font-smoothing:antialiased;}
button{font-family:'Lora',Georgia,serif;cursor:pointer;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:#0a0a0a;}
::-webkit-scrollbar-thumb{background:var(--green);border-radius:2px;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.fade-in{animation:fadeIn 0.3s ease forwards;}
.app{max-width:500px;margin:0 auto;padding-bottom:60px;}
/* Header */
.header{background:linear-gradient(180deg,#050505,#0a0a0a);border-bottom:1px solid rgba(45,106,79,0.25);padding:20px 16px 14px;position:sticky;top:0;z-index:100;}
.header-row{display:flex;align-items:center;justify-content:space-between;}
.header-title{font-size:20px;font-weight:700;letter-spacing:1.5px;background:linear-gradient(135deg,#52b87a,#e8b94a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.header-sub{font-size:10px;color:rgba(255,255,255,0.3);letter-spacing:2px;text-transform:uppercase;margin-top:2px;}
.signout-btn{background:none;border:1px solid rgba(255,255,255,0.1);border-radius:8px;padding:5px 10px;color:rgba(255,255,255,0.4);font-size:11px;transition:all 0.2s;}
.saving{font-size:10px;color:rgba(110,216,152,0.5);letter-spacing:1px;animation:pulse 1s ease infinite;}
/* Day nav */
.day-nav{display:flex;align-items:center;justify-content:space-between;padding:10px 16px;background:#0d0d0d;border-bottom:1px solid rgba(255,255,255,0.06);}
.day-nav-btn{background:none;border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:rgba(255,255,255,0.4);padding:4px 12px;font-size:18px;transition:all 0.15s;}
.day-nav-btn:disabled{opacity:0.2;cursor:default;}
.day-num{font-size:18px;font-weight:700;background:linear-gradient(135deg,#e8b94a,#c9963a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.today-badge{font-size:10px;color:#6ed898;letter-spacing:1px;animation:pulse 2s ease infinite;margin-left:6px;}
.last10-badge{font-size:9px;padding:2px 8px;border-radius:20px;background:rgba(201,150,58,0.15);border:1px solid rgba(201,150,58,0.3);color:#e8b94a;margin-left:6px;}
.day-date{font-size:11px;color:rgba(255,255,255,0.35);margin-top:1px;text-align:center;}
/* Tabs */
.tabs{display:flex;gap:4px;padding:10px 12px;background:#0a0a0a;border-bottom:1px solid rgba(255,255,255,0.06);overflow-x:auto;scrollbar-width:none;}
.tabs::-webkit-scrollbar{display:none;}
.tab-btn{flex:0 0 auto;padding:7px 13px;border-radius:20px;border:1px solid rgba(255,255,255,0.07);background:transparent;color:rgba(255,255,255,0.4);font-size:12px;white-space:nowrap;transition:all 0.2s;}
.tab-btn.active{border-color:rgba(45,106,79,0.7);background:rgba(45,106,79,0.15);color:#6ed898;}
/* Content */
.content{padding:14px 16px;}
.card{background:#111;border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:16px;margin-bottom:12px;}
.card-title{font-size:10px;text-transform:uppercase;letter-spacing:2.5px;color:rgba(255,255,255,0.25);margin-bottom:14px;}
/* Prayer card */
.prayer-card{border-radius:14px;border:1.5px solid rgba(255,255,255,0.07);padding:14px;margin-bottom:10px;background:rgba(255,255,255,0.02);transition:all 0.25s;}
.prayer-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;}
.prayer-name-text{font-size:15px;font-weight:600;}
.prayer-time{font-size:11px;color:rgba(255,255,255,0.35);}
.prayer-arabic{font-family:'Noto Naskh Arabic',serif;font-size:18px;color:rgba(255,255,255,0.15);}
/* Rubric */
.rubric-row{display:flex;gap:5px;}
.rub-btn{flex:1;border:1.5px solid rgba(255,255,255,0.07);border-radius:10px;background:rgba(255,255,255,0.02);padding:7px 3px;text-align:center;transition:all 0.18s;display:flex;flex-direction:column;align-items:center;gap:2px;}
.rub-btn:hover{transform:translateY(-1px);}
.rub-emoji{font-size:15px;line-height:1;}
.rub-num{font-size:10px;font-weight:700;}
.rub-label{font-size:8px;color:rgba(255,255,255,0.3);line-height:1.2;text-align:center;}
/* Dhikr */
.dhikr-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.dhikr-card{border:1px solid rgba(255,255,255,0.07);border-radius:14px;padding:12px 10px;background:rgba(255,255,255,0.02);position:relative;overflow:hidden;transition:all 0.2s;user-select:none;}
.dhikr-card:active{transform:scale(0.97);}
.dhikr-card.complete{border-color:rgba(45,106,79,0.55);background:rgba(45,106,79,0.1);}
.dhikr-arabic{font-family:'Noto Naskh Arabic',serif;font-size:17px;text-align:center;margin-bottom:4px;line-height:1.4;}
.dhikr-trans{font-size:10px;color:rgba(255,255,255,0.35);text-align:center;margin-bottom:7px;}
.dhikr-count{text-align:center;font-size:24px;font-weight:700;line-height:1;}
.dhikr-count.done{color:#6ed898;font-size:20px;}
.dhikr-sub{font-size:10px;color:rgba(255,255,255,0.25);text-align:center;}
.dhikr-bar{position:absolute;bottom:0;left:0;height:3px;background:linear-gradient(90deg,#2d6a4f,#c9963a);transition:width 0.25s;}
/* Stars */
.stars{display:flex;gap:6px;justify-content:center;}
.star-btn{background:none;border:none;font-size:28px;padding:2px;line-height:1;transition:all 0.15s;}
/* Progress */
.prog-row{margin-bottom:10px;}
.prog-label{display:flex;justify-content:space-between;font-size:12px;color:rgba(255,255,255,0.5);margin-bottom:4px;}
.prog-track{height:5px;background:rgba(255,255,255,0.06);border-radius:3px;overflow:hidden;}
.prog-fill{height:100%;border-radius:3px;transition:width 0.6s cubic-bezier(0.4,0,0.2,1);}
/* Calendar */
.cal-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:6px;}
.cal-day{aspect-ratio:1;border-radius:10px;border:1px solid rgba(255,255,255,0.07);display:flex;flex-direction:column;align-items:center;justify-content:center;cursor:pointer;background:rgba(255,255,255,0.02);position:relative;overflow:hidden;transition:all 0.15s;}
.cal-day:hover{border-color:var(--green);}
.cal-day.today{border-color:#2d6a4f;box-shadow:0 0 10px rgba(45,106,79,0.25);}
.cal-day.selected{border-color:#e8b94a;background:rgba(201,150,58,0.08);}
.cal-day.future{opacity:0.35;cursor:default;}
.cal-day-bar{position:absolute;bottom:0;left:0;right:0;height:3px;}
/* Share */
.share-btn{width:100%;padding:14px;border-radius:12px;background:linear-gradient(135deg,#2d6a4f,#1e4d38);border:1px solid rgba(45,106,79,0.4);color:#fff;font-size:14px;font-weight:700;letter-spacing:1px;transition:opacity 0.2s;margin-bottom:8px;}
.share-output{padding:12px;border-radius:10px;background:rgba(45,106,79,0.1);border:1px solid rgba(45,106,79,0.3);font-size:12px;color:#6ed898;white-space:pre-wrap;line-height:1.7;margin-top:8px;}
/* Opt cards */
.opt-row{display:flex;gap:10px;margin-bottom:14px;}
.opt-card{flex:1;padding:14px 10px;border-radius:14px;border:1.5px solid rgba(255,255,255,0.07);background:rgba(255,255,255,0.02);text-align:center;cursor:pointer;transition:all 0.22s;user-select:none;}
.opt-card.done{border-color:rgba(201,150,58,0.5);background:rgba(201,150,58,0.08);}
/* Login */
.login-page{min-height:100vh;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px;position:relative;overflow:hidden;}
.login-top-line{position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,transparent,#2d6a4f,#c9963a,#2d6a4f,transparent);}
.login-title{font-size:32px;font-weight:700;letter-spacing:2px;text-align:center;background:linear-gradient(135deg,#52b87a,#e8b94a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px;line-height:1.2;}
.google-btn{width:100%;max-width:380px;padding:16px 24px;border-radius:14px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.08);color:#fff;font-size:15px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:12px;transition:all 0.2s;letter-spacing:0.5px;}
.google-btn:hover{background:rgba(255,255,255,0.13);}
.feature-pill{padding:5px 12px;border-radius:20px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);font-size:11px;color:rgba(255,255,255,0.45);}
/* Quran toggle */
.quran-toggle{width:100%;padding:22px 20px;border-radius:16px;cursor:pointer;text-align:center;border:1.5px solid rgba(255,255,255,0.07);background:rgba(255,255,255,0.02);transition:all 0.3s;margin-bottom:12px;user-select:none;}
.quran-toggle.done{border-color:rgba(110,216,152,0.4);background:rgba(45,106,79,0.1);}
/* Splash */
.splash{min-height:100vh;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;}
/* Future notice */
.future-notice{margin:12px 16px 0;padding:10px 14px;border-radius:10px;background:rgba(201,150,58,0.07);border:1px solid rgba(201,150,58,0.2);font-size:12px;color:rgba(201,150,58,0.7);text-align:center;}
</style>
</head>
<body>

<div id="root"></div>

<script>
// â”€â”€â”€ CONFIG â€” REPLACE THESE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SUPABASE_URL = 'https://kqfgaiqvaovagbbiqzej.supabase.co';
const SUPABASE_KEY = 'sb_publishable_9LEJDNfmkgGlaker4cYZ_A_b-9uChSE';
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const { createClient } = supabase;
const sb = createClient(SUPABASE_URL, SUPABASE_KEY);

const RAMADAN_START = new Date('2026-02-18');
const TOTAL_DAYS = 30;

const RUBRIC = [
  {level:1,label:'Negligent', short:'Rushed',    emoji:'ğŸ˜”',color:'#ef4444',desc:'Careless, poor wudu, fast movements'},
  {level:2,label:'Distracted',short:'Wandering', emoji:'ğŸ˜',color:'#f97316',desc:'Thinking of past/future, weak focus'},
  {level:3,label:'Striver',   short:'Fighting',  emoji:'ğŸŒ±',color:'#eab308',desc:"Refocusing, calm, battling khushu'"},
  {level:4,label:'Present',   short:'Focused',   emoji:'ğŸŒ¿',color:'#22c55e',desc:'Calm recitation, mindful tasbih'},
  {level:5,label:'Ihsan',     short:'With Allah',emoji:'ğŸŒŸ',color:'#4ade80',desc:'Deep humility â€” feels before Allah'},
];

const PRAYERS = [
  {id:'fajr',   name:'Fajr',   arabic:'Ø§Ù„ÙØ¬Ø±',  time:'Dawn',      icon:'ğŸŒ…',optional:false},
  {id:'dhuhr',  name:'Dhuhr',  arabic:'Ø§Ù„Ø¸Ù‡Ø±',  time:'Midday',    icon:'â˜€ï¸',optional:false},
  {id:'asr',    name:'Asr',    arabic:'Ø§Ù„Ø¹ØµØ±',  time:'Afternoon', icon:'ğŸŒ¤',optional:false},
  {id:'maghrib',name:'Maghrib',arabic:'Ø§Ù„Ù…ØºØ±Ø¨', time:'Sunset',    icon:'ğŸŒ‡',optional:false},
  {id:'isha',   name:'Isha',   arabic:'Ø§Ù„Ø¹Ø´Ø§Ø¡', time:'Night',     icon:'ğŸŒ™',optional:false},
  {id:'duha',   name:'Duha',   arabic:'Ø§Ù„Ø¶Ø­Ù‰',  time:'Forenoon',  icon:'â­',optional:true},
  {id:'tarawih',name:'Tarawih',arabic:'Ø§Ù„ØªØ±Ø§ÙˆÙŠØ­',time:'Late Night',icon:'âœ¨',optional:true},
];

const ADHKAR = [
  {id:'subhanallah',   arabic:'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù',                    trans:'SubhanAllah'},
  {id:'alhamdulillah', arabic:'Ø§ÙÙ„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‡Ù',                   trans:'Alhamdulillah'},
  {id:'allahuakbar',   arabic:'Ø§Ù„Ù„Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù',                     trans:'Allahu Akbar'},
  {id:'laIlaha',       arabic:'Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„Ù‡Ù',            trans:'La ilaha illAllah'},
  {id:'astaghfirullah',arabic:'Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù',               trans:'Astaghfirullah'},
  {id:'salawat',       arabic:'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù',  trans:'Allahumma salli Ê¿ala Muhammad'},
  {id:'yunus',         arabic:'Ù„ÙÙ‘Ø¢ Ø¥ÙÙ„ÙÙ€Ù°Ù‡Ù Ø¥ÙÙ„ÙÙ‘Ø¢ Ø£ÙÙ†ØªÙ Ø³ÙØ¨Ù’Ø­ÙÙ€Ù°Ù†ÙÙƒÙ',trans:"DuÊ¿a of Yunus (AS)"},
  {id:'hawqala',       arabic:'Ù„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„Ù‡Ù',trans:'La hawla wa la quwwata'},
  {id:'laylDua',       arabic:'Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø¹ÙÙÙÙˆÙŒÙ‘',        trans:'Laylatul Qadr DuÊ¿a'},
  {id:'sayyid',        arabic:'Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ Ø±ÙØ¨ÙÙ‘ÙŠ',          trans:'Sayyid al-Istighfar'},
];

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  user: null,
  loading: true,
  tab: 'salah',
  viewDay: 1,
  todayDay: 1,
  allData: {},
  saving: false,
  shareMsg: '',
  saveTimer: null,
};

function getTodayDay() {
  const d = new Date(); d.setHours(0,0,0,0);
  const s = new Date(RAMADAN_START); s.setHours(0,0,0,0);
  const diff = Math.floor((d - s) / 86400000) + 1;
  return (diff >= 1 && diff <= 30) ? diff : 1;
}

function getDateForDay(n) {
  const d = new Date(RAMADAN_START);
  d.setDate(d.getDate() + n - 1);
  return d;
}

function defaultDay() {
  return {prayers:{},optional:{},adhkar:{},quran:false,kindness:0};
}

function avgQ(prayers) {
  const vals = Object.values(prayers).filter(v => v > 0);
  if (!vals.length) return 0;
  return vals.reduce((a,b)=>a+b,0)/vals.length;
}

function dayScore(data) {
  const pc = Object.values(data.prayers).filter(v=>v>0).length;
  const aq = avgQ(data.prayers);
  const oc = Object.values(data.optional).filter(Boolean).length;
  const ad = ADHKAR.filter(z=>(data.adhkar[z.id]||0)>=100).length;
  return Math.round((pc/5)*30+(aq/5)*15+(oc/2)*10+(data.quran?20:0)+(ad/10)*15+(data.kindness/5)*10);
}

function qColor(q) {
  if(!q) return 'rgba(255,255,255,0.1)';
  return RUBRIC[q-1]?.color||'#fff';
}

// â”€â”€â”€ Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAllData() {
  const {data,error} = await sb.from('ramadan_days').select('day_number,data').eq('user_id',state.user.id).eq('year',2026);
  const result = {};
  for(let d=1;d<=TOTAL_DAYS;d++) result[d]=defaultDay();
  if(!error && data) data.forEach(r=>{ result[r.day_number]=r.data; });
  state.allData = result;
  state.loading = false;
  render();
}

function updateDay(patch) {
  if(state.viewDay > state.todayDay) return;
  const cur = state.allData[state.viewDay] || defaultDay();
  state.allData[state.viewDay] = {...cur,...patch};
  state.saving = true;
  render();
  if(state.saveTimer) clearTimeout(state.saveTimer);
  state.saveTimer = setTimeout(async()=>{
    await sb.from('ramadan_days').upsert({
      user_id:state.user.id, year:2026, day_number:state.viewDay,
      data:state.allData[state.viewDay], updated_at:new Date().toISOString()
    },{onConflict:'user_id,year,day_number'});
    state.saving=false; render();
  },600);
}

// â”€â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function signInGoogle() {
  await sb.auth.signInWithOAuth({provider:'google',options:{redirectTo:window.location.href}});
}
async function signOut() {
  await sb.auth.signOut();
  state.user=null; state.allData={}; render();
}

sb.auth.onAuthStateChange(async(_,session)=>{
  state.user = session?.user||null;
  if(state.user) {
    state.todayDay = getTodayDay();
    state.viewDay = state.todayDay;
    await loadAllData();
  } else {
    state.loading=false; render();
  }
});

// â”€â”€â”€ Share â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function share() {
  const data = state.allData[state.viewDay]||defaultDay();
  const date = getDateForDay(state.viewDay);
  const ds = date.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
  const sc = dayScore(data);
  const ad = ADHKAR.filter(z=>(data.adhkar[z.id]||0)>=100).length;
  const lines = [
    `ğŸŒ™ Ramadan 1447 â€” Day ${state.viewDay} (${ds})`,''
    ,'ğŸ•Œ Prayer Quality:',
    ...PRAYERS.filter(p=>!p.optional).map(p=>{
      const q=data.prayers[p.id]||0;
      return `  ${p.icon} ${p.name}: ${q?RUBRIC[q-1].emoji+' '+RUBRIC[q-1].label:'â€”'}`;
    }),
    `  â­ Duha: ${data.optional.duha?'âœ…':'â€”'}  âœ¨ Tarawih: ${data.optional.tarawih?'âœ…':'â€”'}`,
    '',`ğŸ“– Qur'an (1 Juz): ${data.quran?'âœ…':'â€”'}`,
    `ğŸ“¿ Adhkar (100Ã—): ${ad}/10`,
    `ğŸ’š Kindness: ${'â˜…'.repeat(data.kindness)}${'â˜†'.repeat(5-data.kindness)}`,
    '',`â­ Day Score: ${sc}/100`,'','Ramadan Mubarak! ğŸ¤²'
  ];
  try{ await navigator.clipboard.writeText(lines.join('\n')); state.shareMsg='âœ… Copied!'; }
  catch{ state.shareMsg=lines.join('\n'); }
  render();
  setTimeout(()=>{ state.shareMsg=''; render(); },4000);
}

// â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function render() {
  const root = document.getElementById('root');
  if(state.loading) { root.innerHTML=splashHTML(); return; }
  if(!state.user)   { root.innerHTML=loginHTML();  return; }
  root.innerHTML=appHTML();
  attachEvents();
}

function splashHTML() {
  return `<div class="splash"><div style="font-size:52px;animation:pulse 1.5s ease infinite">ğŸŒ™</div><div style="font-size:13px;letter-spacing:3px;text-transform:uppercase;background:linear-gradient(135deg,#3d8b5e,#e8b94a);-webkit-background-clip:text;-webkit-text-fill-color:transparent">Ramadan 1447</div></div>`;
}

function loginHTML() {
  return `<div class="login-page">
  <div class="login-top-line"></div>
  <div style="width:100%;max-width:380px;display:flex;flex-direction:column;align-items:center;animation:fadeIn 0.5s ease">
    <div style="font-size:64px;margin-bottom:8px;line-height:1">ğŸŒ™</div>
    <div style="font-size:11px;color:rgba(255,255,255,0.2);letter-spacing:4px;margin-bottom:8px">âœ¦ âœ¦ âœ¦</div>
    <div class="login-title">Ramadan Tracker</div>
    <div style="font-size:14px;color:rgba(255,255,255,0.35);letter-spacing:2px;margin-bottom:6px">1447 Â· 2026</div>
    <div style="font-size:13px;color:rgba(255,255,255,0.2);margin-bottom:40px;font-style:italic">Feb 18 â€“ Mar 19 Â· 30 Days</div>
    <div style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:36px">
      ${['ğŸ•Œ Prayer Quality','ğŸ“¿ Adhkar 100Ã—','ğŸ“– Daily Qur\'an','ğŸ“… 30-Day Calendar','â˜ï¸ Syncs Everywhere'].map(f=>`<div class="feature-pill">${f}</div>`).join('')}
    </div>
    <button class="google-btn" onclick="signInGoogle()">
      <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="#4285F4"/><path d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z" fill="#34A853"/><path d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.961H.957C.347 6.175 0 7.55 0 9s.348 2.825.957 4.039l3.007-2.332z" fill="#FBBC05"/><path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.961L3.964 6.293C4.672 4.166 6.656 3.58 9 3.58z" fill="#EA4335"/></svg>
      Continue with Google
    </button>
    <div style="margin-top:24px;font-size:11px;color:rgba(255,255,255,0.18);text-align:center;line-height:1.7">Your data syncs securely across all your devices.<br/>Sign in on any phone or laptop â€” never lose progress.</div>
    <div style="margin-top:40px;padding:14px 20px;border-radius:12px;background:rgba(45,106,79,0.08);border:1px solid rgba(45,106,79,0.2);text-align:center;width:100%">
      <div style="font-family:'Noto Naskh Arabic',serif;font-size:18px;color:rgba(110,216,152,0.6);margin-bottom:6px;line-height:1.5">Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù Ù…ÙØ¨ÙØ§Ø±ÙÙƒÙŒ</div>
      <div style="font-size:11px;color:rgba(255,255,255,0.2);font-style:italic">Ramadan Mubarak</div>
    </div>
  </div>
</div>`;
}

function appHTML() {
  const data = state.allData[state.viewDay]||defaultDay();
  const isFuture = state.viewDay > state.todayDay;
  const isLastTen = state.viewDay >= 21;
  const date = getDateForDay(state.viewDay);
  const dateStr = date.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
  const score = dayScore(data);
  const pDone = Object.values(data.prayers).filter(v=>v>0).length;
  const aqVal = avgQ(data.prayers);
  const adDone = ADHKAR.filter(z=>(data.adhkar[z.id]||0)>=100).length;
  const optDone = ['duha','tarawih'].filter(id=>data.optional[id]).length;

  const tabs = [
    {id:'salah',label:'ğŸ•Œ Salah'},
    {id:'adhkar',label:'ğŸ“¿ Adhkar'},
    {id:'soul',label:'ğŸ“– Soul'},
    {id:'calendar',label:'ğŸ“… Calendar'},
    {id:'score',label:'â­ Score'},
  ];

  let tabContent = '';
  if(state.tab==='salah') tabContent = salahTab(data,isFuture);
  else if(state.tab==='adhkar') tabContent = adhkarTab(data,isFuture,adDone);
  else if(state.tab==='soul') tabContent = soulTab(data,isFuture,isLastTen);
  else if(state.tab==='calendar') tabContent = calendarTab(score);
  else if(state.tab==='score') tabContent = scoreTab(data,score,pDone,aqVal,adDone,optDone,dateStr);

  return `<div class="app">
  <div class="header">
    <div class="header-row">
      <div>
        <div style="font-size:10px;letter-spacing:3px;text-transform:uppercase;color:rgba(255,255,255,0.3);margin-bottom:2px">ğŸŒ™ Ramadan 1447</div>
        <div class="header-title">Good Deeds Tracker</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        ${state.saving?'<div class="saving">savingâ€¦</div>':''}
        <button class="signout-btn" onclick="signOut()">Sign out</button>
      </div>
    </div>
  </div>

  <div class="day-nav">
    <button class="day-nav-btn" onclick="changeDay(-1)" ${state.viewDay<=1?'disabled':''}>â€¹</button>
    <div style="text-align:center">
      <div style="display:flex;align-items:center;justify-content:center">
        <span class="day-num">Day ${state.viewDay}</span>
        ${state.viewDay===state.todayDay?'<span class="today-badge">â— TODAY</span>':''}
        ${isLastTen?'<span class="last10-badge">Last 10 âœ¨</span>':''}
      </div>
      <div class="day-date">${dateStr}</div>
    </div>
    <button class="day-nav-btn" onclick="changeDay(1)" ${state.viewDay>=TOTAL_DAYS?'disabled':''}>â€º</button>
  </div>

  <div class="tabs">
    ${tabs.map(t=>`<button class="tab-btn ${state.tab===t.id?'active':''}" onclick="setTab('${t.id}')">${t.label}</button>`).join('')}
  </div>

  ${isFuture?'<div class="future-notice">Viewing a future day â€” tracking unlocks on '+dateStr+'</div>':''}

  <div class="content fade-in">${tabContent}</div>
</div>`;
}

function salahTab(data,isFuture) {
  const rubricGuide = `<div class="card" style="margin-bottom:16px">
    <div class="card-title">Namaz Rubric â€” Tap your level for each prayer</div>
    ${RUBRIC.map(r=>`<div style="display:flex;align-items:flex-start;gap:10px;margin-bottom:6px">
      <span style="font-size:15px;width:20px;text-align:center;flex-shrink:0">${r.emoji}</span>
      <span style="font-size:11px;font-weight:700;color:${r.color};width:76px;flex-shrink:0">${r.level}. ${r.label}</span>
      <span style="font-size:11px;color:rgba(255,255,255,0.35);line-height:1.4">${r.desc}</span>
    </div>`).join('')}
  </div>`;

  const prayerCards = PRAYERS.filter(p=>!p.optional).map(p=>{
    const q = data.prayers[p.id]||0;
    const done = q>0;
    const rubBtns = RUBRIC.map(r=>{
      const sel=q===r.level;
      return `<button class="rub-btn" onclick="${isFuture?'':''} setPrayer('${p.id}',${sel?0:r.level})"
        style="border-color:${sel?r.color:'rgba(255,255,255,0.07)'};background:${sel?r.color+'20':'rgba(255,255,255,0.02)'};transform:${sel?'scale(1.06)':'scale(1)'}">
        <span class="rub-emoji">${r.emoji}</span>
        <span class="rub-num" style="color:${sel?r.color:'rgba(255,255,255,0.4)'}">${r.level}</span>
        <span class="rub-label">${r.short}</span>
      </button>`;
    }).join('');
    return `<div class="prayer-card" style="border-color:${done?qColor(q)+'55':'rgba(255,255,255,0.07)'};background:${done?qColor(q)+'0a':'rgba(255,255,255,0.02)'}">
      <div class="prayer-header">
        <div style="display:flex;align-items:center;gap:10px">
          <span style="font-size:20px">${p.icon}</span>
          <div>
            <div class="prayer-name-text" style="color:${done?qColor(q):'#f0f4f1'}">${p.name}</div>
            <div class="prayer-time">${p.time}</div>
          </div>
        </div>
        <div class="prayer-arabic">${p.arabic}</div>
      </div>
      <div class="rubric-row">${rubBtns}</div>
    </div>`;
  }).join('');

  const optCards = PRAYERS.filter(p=>p.optional).map(p=>`
    <div class="opt-card ${data.optional[p.id]?'done':''}" onclick="toggleOpt('${p.id}')">
      <div style="font-size:26px;margin-bottom:4px">${data.optional[p.id]?'ğŸŒŸ':p.icon}</div>
      <div style="font-size:14px;font-weight:600;color:${data.optional[p.id]?'#e8b94a':'#f0f4f1'}">${p.name}</div>
      <div style="font-size:11px;color:rgba(255,255,255,0.3)">${p.time}</div>
    </div>`).join('');

  return rubricGuide+prayerCards+
    `<div class="card-title" style="margin-top:8px;margin-bottom:8px">Optional Prayers</div>
    <div class="opt-row">${optCards}</div>
    <div style="padding:12px 14px;border-radius:12px;background:rgba(45,106,79,0.07);border:1px solid rgba(45,106,79,0.2);font-size:12px;color:rgba(110,216,152,0.6);font-style:italic;line-height:1.6">
      "O Allah, grant me humility in salah and khushu' in worship." ğŸ¤²
    </div>`;
}

function adhkarTab(data,isFuture,adDone) {
  const cards = ADHKAR.map(z=>{
    const count = data.adhkar[z.id]||0;
    const done = count>=100;
    const pct = Math.min((count/100)*100,100);
    return `<div class="dhikr-card ${done?'complete':''}" onclick="${done?'resetDhikr':'tapDhikr'}('${z.id}')">
      <div class="dhikr-arabic">${z.arabic}</div>
      <div class="dhikr-trans">${z.trans}</div>
      ${done
        ?`<div class="dhikr-count done">âœ“</div><div class="dhikr-sub" style="color:rgba(110,216,152,0.5)">tap reset</div>`
        :`<div class="dhikr-count">${count}</div><div class="dhikr-sub">/ 100</div>`}
      <div class="dhikr-bar" style="width:${pct}%"></div>
    </div>`;
  }).join('');
  return `<div style="font-size:12px;color:rgba(255,255,255,0.35);margin-bottom:14px;line-height:1.6">
    Tap each dhikr to count to <strong style="color:#e8b94a">100Ã—</strong>. Turns green when complete. Tap to reset.
  </div>
  <div class="dhikr-grid">${cards}</div>
  <div style="margin-top:12px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);text-align:center;font-size:12px;color:rgba(255,255,255,0.3)">
    ${adDone}/10 adhkar completed today
  </div>`;
}

function soulTab(data,isFuture,isLastTen) {
  const stars = [1,2,3,4,5].map(s=>`
    <button class="star-btn" onclick="setKindness(${s})"
      style="color:${s<=data.kindness?'#e8b94a':'rgba(201,150,58,0.2)'};transform:${s<=data.kindness?'scale(1.2)':'scale(1)'}">â˜…</button>
  `).join('');
  const kindnessLabels=['Tap to rate','A start â€” keep trying ğŸ¤²','Growing in kindness ğŸŒ±','Half way there ğŸŒ¿','Very kind today ğŸŒŸ','MashaAllah! Heart of gold ğŸ’›'];
  const layl = isLastTen?`<div style="padding:16px;border-radius:14px;background:rgba(201,150,58,0.06);border:1px solid rgba(201,150,58,0.25)">
    <div style="font-size:13px;color:#e8b94a;font-weight:700;margin-bottom:8px">ğŸŒŸ Last 10 Nights â€” Seek Laylatul Qadr</div>
    <div style="font-family:'Noto Naskh Arabic',serif;font-size:18px;color:rgba(232,185,74,0.6);margin-bottom:6px;line-height:1.6">Ø§ÙÙ„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘ÙƒÙ Ø¹ÙÙÙÙˆÙŒÙ‘ ØªÙØ­ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙÙÙ’ÙˆÙ ÙÙØ§Ø¹Ù’ÙÙ Ø¹ÙÙ†ÙÙ‘ÙŠ</div>
    <div style="font-size:11px;color:rgba(201,150,58,0.5);font-style:italic;line-height:1.5">"Allahumma innaka Ê¿afuwwun tuhibbul-Ê¿afwa, faÊ¿fu Ê¿anni"<br/>Taught by the Prophet ï·º to Aisha (RA)</div>
  </div>`:'';
  return `<div class="quran-toggle ${data.quran?'done':''}" onclick="toggleQuran()">
    <div style="font-size:42px;margin-bottom:8px">${data.quran?'ğŸ“–âœ…':'ğŸ“–'}</div>
    <div style="font-size:18px;font-weight:600;color:${data.quran?'#6ed898':'#f0f4f1'}">1 Juz of Qur'an</div>
    <div style="font-size:12px;color:rgba(255,255,255,0.35);margin-top:4px">${data.quran?"Completed â€” Barak Allahu feek! ğŸŒ¿":"Tap to mark complete"}</div>
  </div>
  <div class="card">
    <div style="text-align:center;margin-bottom:14px">
      <div style="font-size:32px;margin-bottom:4px">ğŸ’š</div>
      <div style="font-size:16px;font-weight:600">Kindness Self-Score</div>
      <div style="font-size:12px;color:rgba(255,255,255,0.35);margin-top:3px">How kind were you today?</div>
    </div>
    <div class="stars">${stars}</div>
    <div style="text-align:center;margin-top:10px;font-size:13px;color:rgba(255,255,255,0.35)">${kindnessLabels[data.kindness]}</div>
  </div>${layl}`;
}

function calendarTab() {
  const days = Array.from({length:TOTAL_DAYS},(_,i)=>i+1).map(d=>{
    const dd = state.allData[d]||defaultDay();
    const sc = dayScore(dd);
    const future = d>state.todayDay;
    const av = Math.round(avgQ(dd.prayers));
    const date = getDateForDay(d);
    const dl = date.toLocaleDateString('en-US',{day:'numeric',month:'short'});
    const lastTen = d>=21;
    return `<div class="cal-day ${d===state.todayDay?'today':''} ${d===state.viewDay?'selected':''} ${future?'future':''}"
      onclick="goToDay(${d})"
      style="background:${lastTen&&!future?'rgba(201,150,58,0.03)':'rgba(255,255,255,0.02)'}">
      <div style="font-size:12px;font-weight:700;color:${d===state.todayDay?'#6ed898':d===state.viewDay?'#e8b94a':'#f0f4f1'};line-height:1">${d}</div>
      <div style="font-size:7px;color:rgba(255,255,255,0.25);margin-top:1px">${dl}</div>
      ${!future&&sc>0?`<div style="font-size:8px;color:#6ed898;margin-top:2px">${sc}</div>`:''}
      ${lastTen&&!future?'<div style="font-size:8px;line-height:1;margin-top:1px">âœ¨</div>':''}
      ${!future&&av>0?`<div class="cal-day-bar" style="background:${qColor(av)}"></div>`:''}
    </div>`;
  }).join('');

  const comp = Object.entries(state.allData).filter(([d])=>parseInt(d)<=state.todayDay);
  const tot = comp.reduce((s,[,dd])=>s+dayScore(dd),0);
  const avg_ = Math.round(tot/(comp.length||1));
  const totP = comp.reduce((s,[,dd])=>s+Object.values(dd.prayers).filter(v=>v>0).length,0);
  const totQ = comp.filter(([,dd])=>dd.quran).length;

  return `<div style="font-size:11px;color:rgba(255,255,255,0.25);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px">Feb 18 â€“ Mar 19, 2026 Â· Ramadan 1447</div>
  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px">
    ${RUBRIC.map(r=>`<div style="display:flex;align-items:center;gap:4px;font-size:10px;color:rgba(255,255,255,0.4)"><div style="width:8px;height:8px;border-radius:2px;background:${r.color}"></div>${r.short}</div>`).join('')}
  </div>
  <div class="cal-grid">${days}</div>
  <div class="card" style="margin-top:16px">
    <div class="card-title">30-Day Overview</div>
    <div class="prog-row"><div class="prog-label"><span>Avg Daily Score</span><span>${avg_}/100</span></div><div class="prog-track"><div class="prog-fill" style="width:${avg_}%;background:linear-gradient(90deg,#2d6a4f,#c9963a)"></div></div></div>
    <div class="prog-row"><div class="prog-label"><span>Prayers tracked (${totP})</span><span>${Math.min(totP,5*state.todayDay)}/${5*state.todayDay}</span></div><div class="prog-track"><div class="prog-fill" style="width:${Math.min((totP/(5*state.todayDay))*100,100)}%;background:#3d8b5e"></div></div></div>
    <div class="prog-row"><div class="prog-label"><span>Qur'an days</span><span>${totQ}/${state.todayDay}</span></div><div class="prog-track"><div class="prog-fill" style="width:${(totQ/state.todayDay)*100}%;background:#c9963a"></div></div></div>
  </div>`;
}

function scoreTab(data,score,pDone,aqVal,adDone,optDone,dateStr) {
  const prQ = PRAYERS.filter(p=>!p.optional).map(p=>{
    const q=data.prayers[p.id]||0;
    return `<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
      <div style="display:flex;align-items:center;gap:8px;font-size:14px"><span>${p.icon}</span><span>${p.name}</span></div>
      ${q?`<div style="display:flex;align-items:center;gap:6px"><span style="font-size:15px">${RUBRIC[q-1].emoji}</span><span style="font-size:12px;color:${qColor(q)};font-weight:600">${RUBRIC[q-1].label}</span></div>`:'<span style="font-size:12px;color:rgba(255,255,255,0.2)">not rated</span>'}
    </div>`;
  }).join('');

  return `<div style="text-align:center;margin-bottom:20px">
    <div style="width:100px;height:100px;border-radius:50%;background:conic-gradient(#2d6a4f ${score*3.6}deg,rgba(255,255,255,0.05) 0deg);display:flex;align-items:center;justify-content:center;margin:0 auto 12px">
      <div style="width:76px;height:76px;border-radius:50%;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div style="font-size:28px;font-weight:700;background:linear-gradient(135deg,#e8b94a,#c9963a);-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1">${score}</div>
        <div style="font-size:10px;color:rgba(255,255,255,0.3)">/ 100</div>
      </div>
    </div>
    <div style="font-size:18px;color:#e8b94a">${score>=90?"SubhanAllah! ğŸŒŸğŸŒŸğŸŒŸ":score>=70?"Masha'Allah! ğŸŒŸğŸŒŸ":score>=50?"Keep striving! ğŸŒ¿":"Every deed counts ğŸ¤²"}</div>
    <div style="font-size:12px;color:rgba(255,255,255,0.3);margin-top:4px">Day ${state.viewDay} Â· ${dateStr}</div>
  </div>
  <div class="card">
    <div class="card-title">Score Breakdown</div>
    <div class="prog-row"><div class="prog-label"><span>Prayers rated (${pDone}/5) Ã—30</span><span>${pDone}/5</span></div><div class="prog-track"><div class="prog-fill" style="width:${(pDone/5)*100}%;background:#3d8b5e"></div></div></div>
    <div class="prog-row"><div class="prog-label"><span>Avg Quality (${aqVal.toFixed(1)}/5) Ã—15</span><span>${aqVal.toFixed(1)}/5</span></div><div class="prog-track"><div class="prog-fill" style="width:${(aqVal/5)*100}%;background:#52b87a"></div></div></div>
    <div class="prog-row"><div class="prog-label"><span>Optional (${optDone}/2) Ã—10</span><span>${optDone}/2</span></div><div class="prog-track"><div class="prog-fill" style="width:${(optDone/2)*100}%;background:#c9963a"></div></div></div>
    <div class="prog-row"><div class="prog-label"><span>Qur'an 1 Juz Ã—20</span><span>${data.quran?1:0}/1</span></div><div class="prog-track"><div class="prog-fill" style="width:${data.quran?100:0}%;background:#4ecdc4"></div></div></div>
    <div class="prog-row"><div class="prog-label"><span>Adhkar (${adDone}/10) Ã—15</span><span>${adDone}/10</span></div><div class="prog-track"><div class="prog-fill" style="width:${(adDone/10)*100}%;background:#a78bfa"></div></div></div>
    <div class="prog-row"><div class="prog-label"><span>Kindness (${data.kindness}/5) Ã—10</span><span>${data.kindness}/5</span></div><div class="prog-track"><div class="prog-fill" style="width:${(data.kindness/5)*100}%;background:#f97316"></div></div></div>
  </div>
  <div class="card"><div class="card-title">Today's Prayer Quality</div>${prQ}</div>
  <button class="share-btn" onclick="share()">ğŸ”— Share Day ${state.viewDay} Deeds</button>
  ${state.shareMsg?`<div class="share-output">${state.shareMsg}</div>`:''}
  <div style="margin-top:14px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.05);text-align:center;font-size:11px;color:rgba(255,255,255,0.2);line-height:1.8">
    "Our Lord, accept from us. Indeed, You are the Hearing, the Knowing." â€” Qur'an 2:127 ğŸŒ™
  </div>`;
}

// â”€â”€â”€ Event handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function attachEvents() {}

window.setTab = (t) => { state.tab=t; render(); };
window.changeDay = (d) => { state.viewDay=Math.max(1,Math.min(TOTAL_DAYS,state.viewDay+d)); render(); };
window.goToDay = (d) => { state.viewDay=d; state.tab='salah'; render(); };
window.setPrayer = (id,q) => {
  if(state.viewDay>state.todayDay) return;
  const data=state.allData[state.viewDay]||defaultDay();
  updateDay({prayers:{...data.prayers,[id]:q}});
};
window.toggleOpt = (id) => {
  if(state.viewDay>state.todayDay) return;
  const data=state.allData[state.viewDay]||defaultDay();
  updateDay({optional:{...data.optional,[id]:!data.optional[id]}});
};
window.tapDhikr = (id) => {
  if(state.viewDay>state.todayDay) return;
  const data=state.allData[state.viewDay]||defaultDay();
  const cur=data.adhkar[id]||0; if(cur>=100) return;
  updateDay({adhkar:{...data.adhkar,[id]:cur+1}});
};
window.resetDhikr = (id) => {
  if(state.viewDay>state.todayDay) return;
  const data=state.allData[state.viewDay]||defaultDay();
  updateDay({adhkar:{...data.adhkar,[id]:0}});
};
window.toggleQuran = () => {
  if(state.viewDay>state.todayDay) return;
  const data=state.allData[state.viewDay]||defaultDay();
  updateDay({quran:!data.quran});
};
window.setKindness = (v) => {
  if(state.viewDay>state.todayDay) return;
  const data=state.allData[state.viewDay]||defaultDay();
  updateDay({kindness:v===data.kindness?0:v});
};
window.share = share;
window.signOut = signOut;
window.signInGoogle = signInGoogle;

// â”€â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
render();
sb.auth.getSession().then(({data:{session}})=>{
  state.user=session?.user||null;
  if(state.user){ state.todayDay=getTodayDay(); state.viewDay=state.todayDay; loadAllData(); }
  else{ state.loading=false; render(); }
});
</script>
</body>
</html>
